<!DOCTYPE html>
 
 <html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>[{{ NOTEBOOK_NAME }}] {{ abs_path }}</title>
  <style>
  body {
    font-family: sans-serif;
    font-size: 1.4rem;
    background: #f5f5f5;
    line-height: 1.6;
    margin: 2em;
  }
  .copylink, .deletelink {
    cursor: pointer;
    font-size: 0.8em;
    margin-left: 0.3em;
  }
  .notice { color: rgb(0, 35, 151); }
  </style>
  <link rel="stylesheet" href="/static/quicklaunch.css">
  <script src="/static/run_task.js"></script>
  <script>
    async function setClipboard(text) {
      const type = "text/plain";
      const clipboardItemData = {
        [type]: text,
      };
      const clipboardItem = new ClipboardItem(clipboardItemData);
      await navigator.clipboard.write([clipboardItem]);
    }

    function deleteFile(fileUrl) {
        if (!confirm('Are you sure you want to delete this file?\n' + fileUrl)) {
            return;
        }

        const deleteForm = document.getElementById('deleteForm');
        const thepathInput = document.getElementById('thepath');
        thepathInput.value = fileUrl;
        deleteForm.submit();
    }

    document.addEventListener('DOMContentLoaded', function(){
        document.querySelectorAll('.copylink').forEach(el => {
            el.addEventListener('click', (event) => {
                const abspath = event.target.getAttribute('data-abspath');
                setClipboard(abspath);
            });
        });
    });

  </script>
  {% if CUSTOM_HEADER_CONTENT %}
  {{ CUSTOM_HEADER_CONTENT | safe }}
  {% endif %}
  </head>
  <body>

    <h1>Index of {{ abs_path }}</h1>

    {% if QUICKLAUNCH_HTML %}
    {{ QUICKLAUNCH_HTML | safe }}
    {% else %}
    {% include "quicklaunch.html" ignore missing without context %}
    {% endif %}

    <div id="status" class="notice">{{ delete_msg }}</span>

    <table>
      <tr><th>Name</th><th>Last Modified</th><th></th><th></th></tr>
      {% for entry in entries %}
        {% if entry.is_folder %}
          <tr>
            <td>ğŸ“ <a href="{{ entry.name }}/">{{ entry.name }}/</a></td>
            <td></td>
            <td></td>
            <td>{% if entry.absolute_path %} <span class="copylink" data-abspath="{{ entry.absolute_path }}">ğŸ”—</span>{% endif %}</td>
          </tr>
        {% else %}
          <tr>
            <td>ğŸ“„ <a href="{{ entry.name }}">{{ entry.name }}</a>{% if entry.absolute_path %}</td>
            <td>{{ entry.mtime }}</td>
            <td>
              {% if entry.absolute_path %}
                <span class="deletelink" onclick="deleteFile('{{ entry.absolute_path }}')" title="Delete file">ğŸ—‘ï¸</span>
              {% endif %}
            </td>
            <td>
              <span class="copylink" data-abspath="{{ entry.absolute_path }}">ğŸ”—</span>{% endif %}
            </td>
          </tr>
        {% endif %}
      {% endfor %}
    </table>

    <form action="/_delete" method="post" id="deleteForm" style="display:none;">
        <input type="hidden" name="thepath" id="thepath" value="">
        <input type="hidden" name="redirect_to" value="{{ abs_path }}">
    </form>

  </body>
 </html>
